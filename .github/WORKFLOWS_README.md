# GitHub Actions 工作流说明

本仓库包含两个主要的GitHub Actions工作流，用于管理dev和main分支之间的同步。

## 🔄 分支同步工作流 (sync-to-main.yml)

### 功能说明
- **手动触发**: 在GitHub Actions页面手动运行
- **智能同步**: 只同步核心代码文件，自动排除assets/和dev/文件夹
- **安全操作**: 创建备份标签，支持回滚
- **冲突处理**: 自动处理大部分合并场景

### 使用方法
1. 进入仓库的 **Actions** 页面
2. 选择 **"同步dev分支到main分支"** 工作流
3. 点击 **"Run workflow"** 按钮
4. 可选填写自定义提交消息
5. 点击绿色的 **"Run workflow"** 按钮执行

### 输入参数
- **commit_message**: 自定义提交消息（可选）
- **force_sync**: 强制同步选项（谨慎使用）

### 同步的文件类型
- ✅ `.jsx` 脚本文件
- ✅ `readme.md` 文档
- ✅ `.gitignore` 配置文件
- ✅ 其他配置文件 (`.json`, `.yml`, `.txt`)
- ❌ `assets/` 文件夹（资源文件）
- ❌ `dev/` 文件夹（开发文件）

## 🔒 分支保护工作流 (setup-branch-protection.yml)

### 功能说明
- **一次性设置**: 配置dev分支的保护规则
- **访问控制**: 限制dev分支的访问权限
- **自动化配置**: 通过API自动设置保护规则

### 使用方法
1. 进入仓库的 **Actions** 页面
2. 选择 **"配置分支保护规则"** 工作流
3. 手动运行一次即可完成配置

## 📋 分支策略说明

### main分支 (生产分支)
- 🌍 **公开可见**: 对所有用户可见
- 📦 **精简内容**: 只包含核心代码和文档
- 🚫 **排除文件**: 不包含assets/和dev/文件夹
- 🔄 **自动同步**: 通过工作流从dev分支同步

### dev分支 (开发分支)
- 🔒 **受保护**: 访问受限，仅开发者可见
- 📁 **完整内容**: 包含所有开发文件和资源
- 🛠️ **开发环境**: 用于日常开发工作
- 📤 **源分支**: 向main分支推送更新的源头

## 🚀 工作流程建议

### 日常开发
1. 在 `dev` 分支上进行开发工作
2. 提交和推送更改到 `dev` 分支
3. 当需要发布时，运行同步工作流

### 版本发布
1. 确保 `dev` 分支的代码稳定
2. 运行 **"同步dev分支到main分支"** 工作流
3. 在 `main` 分支创建版本标签（如需要）
4. 发布新版本

## ⚠️ 注意事项

### 权限要求
- 工作流需要 `contents: write` 权限
- 分支保护设置需要管理员权限

### 安全提醒
- `dev` 分支包含完整的开发资源，请谨慎管理访问权限
- 同步前请确保 `dev` 分支的代码已经过测试
- 建议在重要更新前手动备份

### 故障排除
- 如果同步失败，检查工作流日志
- 遇到权限问题时，确认GitHub Token权限
- 手动解决冲突后可重新运行工作流

## 📞 支持

如果遇到问题，请：
1. 查看Actions页面的详细日志
2. 检查分支保护设置
3. 确认文件权限和访问控制
4. 在Issues中报告问题
