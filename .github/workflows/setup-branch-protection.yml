name: 分支保护配置指南

# 手动触发，提供分支保护配置指导
on:
  workflow_dispatch:
    inputs:
      show_guide:
        description: '显示分支保护配置指南'
        required: false
        default: true
        type: boolean

permissions:
  contents: read

jobs:
  protection-guide:
    name: 分支保护指南
    runs-on: ubuntu-latest

    steps:
      - name: 输出分支保护配置指南
        run: |
          echo "🔒 GitHub分支保护配置指南"
          echo "================================"
          echo ""
          echo "由于GitHub Actions的权限限制，需要手动配置分支保护规则："
          echo ""
          echo "📋 手动配置步骤："
          echo "1. 进入仓库设置页面："
          echo "   https://github.com/${{ github.repository }}/settings"
          echo ""
          echo "2. 点击左侧菜单中的 'Branches'"
          echo ""
          echo "3. 点击 'Add rule' 按钮"
          echo ""
          echo "4. 配置dev分支保护规则："
          echo "   - Branch name pattern: dev"
          echo "   - ✅ Restrict pushes that create files"
          echo "   - ✅ Restrict pushes that create files (添加仓库所有者)"
          echo "   - ✅ Do not allow bypassing the above settings"
          echo ""
          echo "5. 点击 'Create' 保存设置"
          echo ""
          echo "🎯 配置目标："
          echo "- dev分支: 受保护，仅开发者可访问"
          echo "- main分支: 公开，用于生产环境"
          echo ""
          echo "✅ 配置完成后，dev分支将受到保护"
          echo "🔗 仓库设置链接: https://github.com/${{ github.repository }}/settings/branches"

      - name: 检查当前分支状态
        run: |
          echo ""
          echo "📊 当前仓库状态："
          echo "- 默认分支: ${{ github.event.repository.default_branch }}"
          echo "- 当前分支: ${{ github.ref_name }}"
          echo "- 仓库所有者: ${{ github.repository_owner }}"
          echo ""
          echo "🌿 分支策略："
          echo "- main: 生产分支（公开，排除assets/和dev/文件夹）"
          echo "- dev: 开发分支（受保护，包含所有开发文件）"
